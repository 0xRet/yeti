from mongoengine import *

from core.entities import Entity


class MalwareFamily(Document):

    name = StringField(required=True, unique=True)

    def __unicode__(self):
        return self.name


class Malware(Entity):

    aliases = ListField(StringField(), verbose_name="Aliases")
    family = ReferenceField(MalwareFamily, verbose_name="Family")

    def add_alias(alias):
        self.modify(add_to_set__aliases=alias)
        self.reload()

    def info(self):
        i = {k: v for k, v in self._data.items() if k in ['name', 'aliases', 'family']}
        i['family'] = self.family.name
        i['id'] = str(self.id)
        i['type'] = "Malware"
        return i

    def generate_tags(self):
        return [self.name.lower(), self.family.name.lower()]
